<% provide(:current_tasks, " class='current'".html_safe) %>
<% provide(:title, "Tasks") %>

<% content_for :additional_styles do %>
  <%= stylesheet_link_tag 'css/styles/table' %>
  <%= stylesheet_link_tag 'css/libs/DataTables/jquery.dataTables' %>
  <%= stylesheet_link_tag 'css/styles/form' %>
  <%= stylesheet_link_tag 'tasks' %>
<% end %>

<% content_for :template_functions do %>
  <%= javascript_include_tag 'application' %>
  <%= javascript_include_tag 'js/developr.table' %>
  <%= javascript_include_tag 'js/libs/jquery.tablesorter.min' %>
  <%= javascript_include_tag 'tasks' %>
<% end %>

<div class="with-padding">

  <div class="small-margin-bottom">
    <% if can? :create, Task %>
      <%= link_to 'New Task', new_task_path, class: 'button icon-star float-left' %>
      <% if can? :manage, Task %>
        <%= link_to 'Report - Tasks by status', rpt_all_tasks_path(format: 'pdf'), class: 'button' %>
        <%= link_to 'Report - Tasks by department', rpt_all_tasks_path(format: 'pdf', order: 'department'), class: 'button' %>
        <%= link_to 'Report - Incomplete Tasks', rpt_all_tasks_path(format: 'pdf', order: 'incomplete'), class: 'button' %>
      <% end %>
    <% end %>
    <div class="float-right">
      <%= form_tag tasks_path, method: :get, id: 'task-search' do %>
        <span class="input">
          <%= text_field_tag :query, params[:query], class: 'input-unstyled', placeholder: 'Looking for something?' %>
          <%= link_to 'Search', 'javascript:void(0)', id: 'task-search-btn', class: 'button compact blue-gradient' %>
        </span>
      <% end %>
    </div>
    <div class="clear-both"></div>
  </div>

  <table id="tablesorter" class="table responsive-table margin-bottom responsive-table-on">

    <thead>
      <tr>
        <th scope="col">Task Name</th>
        <th scope="col">Priority</th>
        <th scope="col">Department</th>
        <th scope="col">Date Due</th>
        <th scope="col">Assigned To</th>
        <th scope="col">Status</th>
        <th scope="col"></th>
      </tr>
    </thead>

    <tbody>

      <% @tasks.each do |task| %>

        <tr>
          <th scope="row"><%= link_to task.name, task %></th>
          <td><%= task.priority %></td>
          <td><%= task.department_name %></td>
          <td><%= date_format(task.due_at) %></td>
          <td><%= task.assignee_full_name %></td>
          <td><%= task.state %></td>
          <td class="align-right low-padding">
            <%= link_to 'Show', task, class: 'button compact' %>
            <% if can? :update, task %>
              <%= link_to 'Edit', edit_task_path(task), class: 'button compact' %>
            <% end %>
            <% if can? :destroy, task %>
              <%= link_to 'Delete', task, method: :delete, class: 'button compact', data: { confirm: 'Are you sure?' } %>
            <% end %>
          </td>
        </tr>

      <% end %>

    </tbody>

  </table>

</div>
